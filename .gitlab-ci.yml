image: docker:stable

services:
  - docker:dind
  
before_script:
- apk add --update python py-pip python-dev && pip install docker-compose && pip install --upgrade pip
- docker version
- docker-compose version

variables:
 MYSQL_DATABASE: AppDB
 MYSQL_ROOT_PASSWORD: root
    
stages:
#- build
- test
- deploy

build:
 script:
 - echo "sono nella fase di build"
 - cd db
 - docker build -t db .
 - cd ../app
 - docker build -t app .
 - docker image ls
 - docker ps
 #- docker run -d -P --name app --link db #immagine python app.py
 #- docker-compose build
 #- docker-compose up
 #only :
  #changes:
  #- Dockerfile
  #- app/Dockerfile
  #- docker-compose
  #- requirements

test:
 script:
 - echo "sono nella fase di test"
 ##- python -m pytest tests/test.py
 #- python tests/test.py
     
#deploy:
 #script:
 #- echo "sono nella fase di deploy"

     
     
